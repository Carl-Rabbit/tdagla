!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tdagla=e():t.tdagla=e()}(self,(()=>(()=>{"use strict";var t={d:(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{create:()=>x});class a{id;data;src;dst;constructor(t,e,s=null){this.id=a.getEdgeId(t,e),this.src=t,this.dst=e,this.data=s}static getEdgeId(t,e){return t.id+"-"+e.id}}function s(t,e){let a=t.indexOf(e);return-1!==a&&(t.splice(a,1),!0)}const d=function(t,e){let a=t[0];return t.forEach((t=>{e(t,a)>0&&(a=t)})),a};class i{id;data;outEdges=[];inEdges=[];constructor(t,e=null){this.id=t,this.data=e}}class n{nodes=[];nodeMap=new Map;edges=[];edgeMap=new Map;addNode(t,e=null){let a=new i(t,e);return this.nodes.push(a),this.nodeMap.set(t,a),a}removeNode(t){this.nodeMap.has(t.id)&&(s(this.nodes,t),this.nodeMap.delete(t.id),t.inEdges.concat(t.outEdges).forEach((t=>this.removeEdge(t))))}removeNodeById(t){let e=this.nodeMap.get(t);e&&this.removeNode(e)}addEdge(t,e,s=null){let d=this.nodeMap.get(t),i=this.nodeMap.get(e);if(void 0===d||void 0===i)return null;let n=new a(d,i,s);return d.outEdges.push(n),i.inEdges.push(n),this.edges.push(n),this.edgeMap.set(n.id,n),n}removeEdge(t){this.edgeMap.has(t.id)&&(s(this.edges,t),this.edgeMap.delete(t.id),s(t.src.outEdges,t),s(t.dst.inEdges,t))}removeEdgeById(t){let e=this.edgeMap.get(t);e&&this.removeEdge(e)}copy(){let t=new n;return this.nodes.forEach((e=>t.addNode(e.id,e.data))),this.edges.forEach((e=>t.addEdge(e.src.id,e.dst.id))),t}}class r{x0;x1;y;render;constructor(t,e,a,s){this.x0=t,this.x1=e,this.y=a,this.render=s}}class o{isHidden=!1;turningX=null}const h=function(t,e,a){if(t.has(e))return t.get(e);const s=a(e);return t.set(e,s),s};class g{rootId;graph;gap;visitedSet;constructor(t,e,a){this.rootId=t,this.graph=e,this.gap=a}solve(){this.computeHiddenEdgeSet(),this.reorderInAndOutEdges(),this.setLines()}computeHiddenEdgeSet(){const t=this.graph.nodes.filter((t=>t.outEdges.length>1));this.graph.edges.forEach((t=>t.data.isHidden=!1)),t.forEach((t=>{const e=t.outEdges.map((t=>t.dst));let a=null;e.every((t=>!t.data.render))?a=e[0]:e.forEach((t=>{t.data.render&&(null===a||a.data.x0>t.data.x0)&&(a=t)})),t.outEdges.forEach((t=>{t.dst!==a&&(t.data.isHidden=!0)}))}))}reorderInAndOutEdges(){const t=new Map;this.visitedSet=new Set;const e=a=>{if(this.visitedSet.has(a.id))return 1/0;this.visitedSet.add(a.id);let s=a.data.x0??1/0;return a.inEdges.filter((t=>!t.data.isHidden)).forEach((t=>{const a=e(t.src);s=Math.min(s,a)})),t.set(a.id,s),s};e(this.graph.nodeMap.get(this.rootId)),this.graph.nodes.forEach((e=>{e.inEdges.sort(((e,a)=>t.get(e.src.id)-t.get(a.src.id))),e.outEdges.sort(((e,a)=>t.get(e.src.id)-t.get(a.src.id)))}))}setLines(){this.visitedSet=new Set;const{lineMap:t}=this.layoutVertex(this.graph.nodeMap.get(this.rootId));for(const e of t.keys()){const a=t.get(e);this.graph.nodeMap.get(e).data.y=a}}layoutVertex(t){const e=new Map,s=new Map,i=t.inEdges.filter((t=>!t.data.isHidden)).map((t=>t.src));if(0===i.length)return t.data.render&&(e.set(t.id,0),h(s,0,(()=>[])).push(t)),{lineMap:e,blocksMap:s};let n=null,r=null,o=0;for(let t=0;t<i.length;++t){const a=i[t];if(this.visitedSet.has(a.id))continue;this.visitedSet.add(a.id);const{lineMap:d,blocksMap:g}=this.layoutVertex(a);if(0===d.size)continue;const l=Math.min(...d.values()),c=Math.max(...d.values());let u=o;if(null!==n){const t=e.get(n.id),i=d.get(a.id);let r=u,h=u;t:for(;;){--h;const e=t=>t-l+h,a=t=>t+l-h;if(e(i)<=t)break;for(let t=e(l);t<o;t++){const e=s.get(t)??[],d=g.get(a(t))??[];for(const t of e)for(const e of d){if(this.isOverlappedConsiderTurningX(t,e))break t;if(n===t&&e.data.turningX<t.data.x0)break t}}r=h}u=r}const p=t=>t-l+u;for(const[t,a]of d.entries()){const s=p(a);e.set(t,s)}for(const[t,e]of g.entries()){const a=p(t);h(s,a,(()=>[])).push(...e)}o=p(c)+1,n=a,r={lineMap:d,blocksMap:g}}if(t.data.render){const n=Math.max(...e.values());let r=1/0,o=-2,g=null;for(let a=-1;a<=n+1;++a){if(!(s.get(a)??[]).every((e=>!this.isOverlapped(e,t))))continue;const d=this.computeChildrenGroups(e,t,i,a);let n=0;d.forEach(((s,d)=>{if(0===s.length)return;const i=Math.max(...s.map((t=>t.data.x1)));s.forEach((t=>{n+=this.computeEdgeCost(t.data.x1,e.get(t.id),i+this.gap,a)})),1===d&&(n+=this.computeEdgeCost(i,a,t.data.x0,a))}));const h=i.reduce(((t,a)=>t+e.get(a.id)),0)/i.length;n+=Math.abs(h-a)*i.length*p,0!==d[0].length&&Math.min(...d[0].map((t=>t.data.x0)))>t.data.x0&&(n+=1/0),n<r&&(r=n,o=a,g=d)}if(-2===o&&console.error("layout error",this,t),-1===o){o=0;for(const[t,a]of e.entries())e.set(t,a+1);const t=new Map;s.forEach(((e,a)=>t.set(a,e))),s.clear(),t.forEach(((t,e)=>{s.set(e+1,t)}))}e.set(t.id,o),h(s,o,(()=>[])).push(t),g.forEach(((i,n)=>{let r;const h=Math.max(...i.map((t=>t.data.x1)));r=Math.min(h+this.gap/2,t.data.x1),i.forEach((i=>{const g=this.graph.edgeMap.get(a.getEdgeId(i,t));if(!g.data.isHidden)if(o===e.get(i.id))g.data.turningX=t.data.x0;else if(1===n){const a=[],n=e.get(i.id);for(let e=Math.min(n,o);e<=Math.max(n,o);++e){const i=s.get(e).filter((e=>e.data.x0<t.data.x0)),n=d(i,((t,e)=>t.data.x0-e.data.x0));n&&a.push(n)}let r=h;if(a.length>0){const e=a.map((e=>{const a=e.outEdges.find((t=>!t.data.isHidden));return a.data.turningX&&a.dst!==t?a.data.turningX:e.data.x1}));r=Math.max(...e)+this.gap/2}g.data.turningX=(r+t.data.x0)/2}else g.data.turningX=r}))}))}else{let d=null;for(const t of e.keys()){const e=this.graph.nodeMap.get(t);(null===d||e.data.x1>d.data.x1)&&(d=e)}if(null!==d){t.data.x0=t.data.x1=d.data.x1;const n=e.get(d.id);e.set(t.id,n),h(s,n,(()=>[])).push(t),i.forEach((e=>{this.graph.edgeMap.get(a.getEdgeId(e,t)).data.turningX=t.data.x0}))}}return{lineMap:e,blocksMap:s}}isOverlapped(t,e){const a=t.data.x0,s=t.data.x1+this.gap,d=e.data.x0,i=e.data.x1+this.gap;return!(s<d||a>i)}isOverlappedConsiderTurningX(t,e){let a=t.data.x0,s=t.data.x1+this.gap,d=e.data.x0,i=e.data.x1+this.gap;return t.outEdges.forEach((t=>{t.data.turningX&&s<t.data.turningX&&(s=t.data.turningX)})),e.outEdges.forEach((t=>{t.data.turningX&&i<t.data.turningX&&(i=t.data.turningX)})),!(s<d||a>i)}computeChildrenGroups(t,e,a,s){const d=a.filter((t=>this.isOverlapped(e,t))),i=d.filter((e=>t.get(e.id)<s)),n=i[i.length-1]??null,r=d.filter((e=>t.get(e.id)>s))[0]??null;let o=0,h=a.length;return null!==n&&(o=a.indexOf(n)+1),null!==r&&(h=a.indexOf(r)),[a.filter(((t,e)=>e<o)),a.filter(((t,e)=>o<=e&&e<h)),a.filter(((t,e)=>h<=e))]}computeEdgeCost(t,e,a,s){let d=0;return d+=Math.abs(t-a)/this.gap*l,d+=Math.abs(e-s)*(c+u*(e<=s?0:1)),d}}const l=1,c=1,u=.05,p=.04;class f{_graph;_gap=20;_lineHeight=10;_lineSpace=4;constructor(){this._graph=new n}setNode({id:t,x0:e,x1:a,render:s=!0}){const d=new r(e,a,0,s);return this._graph.addNode(t,d),this}setEdge({src:t,dst:e}){if(!this._graph.nodeMap.has(t))return console.error("tdagla: Can't find node "+t+". Ignored."),this;if(!this._graph.nodeMap.has(e))return console.error("tdagla: Can't find node "+e+". Ignored."),this;const a=new o;return this._graph.addEdge(t,e,a),this}getNode(t){const e=this._graph.nodeMap.get(t);return e?{id:e.id,x:e.data.x0,y:this._getYTop(e.data.y),x0:e.data.x0,x1:e.data.x1,width:e.data.x1-e.data.x0,height:this._lineHeight}:null}getNodes(){return this._graph.nodes.map((t=>this.getNode(t.id)))}getEdge(t,e){const s=this._graph.nodeMap.get(t),d=this._graph.nodeMap.get(e);if(!s||!d)return null;const i=this._graph.edgeMap.get(a.getEdgeId(s,d));if(!i)return null;const n=this._getEdgePoints(i);return{id:i.id,src:i.src.id,dst:i.dst.id,render:s.data.render&&d.data.render,points:n}}_getYTop(t){return t*(this._lineHeight+this._lineSpace)}_getYCenter(t){return t*(this._lineHeight+this._lineSpace)+this._lineHeight/2}_getEdgePoints(t){const e=t.src,a=t.dst;if(!e.data.render||!a.data.render)return[];const s=e.data.x1,d=a.data.x0,i=a.data.x0+this._gap,n=a.data.x1,r=this._getYCenter(e.data.y),o=this._getYCenter(a.data.y),h=o+this._getOffsetDstY(r,o);if(t.data.turningX===a.data.x0)return[[s,r],[d,o]];if(t.data.isHidden){if(s>=d&&i>=n){const t=(s+n)/2;return[[s,r],[t,r],[t,h],[n,h]]}if(s>=d){const t=s+this._gap/2;return[[s,r],[t,r],[t,h],[i,h]]}{const t=(s+d)/2;return[[s,r],[t,r],[t,o],[d,o]]}}const g=t.data.turningX;return g>=d&&g+this._gap/2>=n?[[s,r],[g,r],[g,h],[n,h]]:g>=d?[[s,r],[g,r],[g,h],[g+this._gap/2,h]]:[[s,r],[g,r],[g,o],[d,o]]}_getOffsetDstY(t,e){return(t<e?-1:1)*this._lineHeight/2}getEdges(){return this._graph.edges.map((t=>this.getEdge(t.src.id,t.dst.id)))}setGap(t){return this._gap=t,this}getGap(){return this._gap}setLineHeight(t){return this._lineHeight=t,this}getLineHeight(){return this._lineHeight}setLineSpace(t){return this._lineSpace=t,this}getLineSpace(){return this._lineSpace}layout(){if(0===this._graph.nodes.length)return;let t=this._graph.nodes[0];for(;0!==t.outEdges.length;)t=t.outEdges[0].dst;new g(t.id,this._graph,this._gap).solve()}}function x(){return new f}return e})()));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBS3dCLEdBQUlLLEtBQUttTCxPQUFRbkwsS0FBS29MLE1BQ3BEekgsU0NsUmhCLFNBQVM2SixJQUNaLE9BQU8sSUFBSXRDLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZGFnbGEvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL3RkYWdsYS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90ZGFnbGEvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3RkYWdsYS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3RkYWdsYS93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3RkYWdsYS8uL3NyYy9ncmFwaC9FZGdlLmpzIiwid2VicGFjazovL3RkYWdsYS8uL3NyYy91dGlscy9BcnJheVV0aWxzLmpzIiwid2VicGFjazovL3RkYWdsYS8uL3NyYy9ncmFwaC9Ob2RlLmpzIiwid2VicGFjazovL3RkYWdsYS8uL3NyYy9ncmFwaC9HcmFwaC5qcyIsIndlYnBhY2s6Ly90ZGFnbGEvLi9zcmMvYWxnby9WZXJ0ZXhMYXlvdXREYXRhLmpzIiwid2VicGFjazovL3RkYWdsYS8uL3NyYy9hbGdvL0VkZ2VMYXlvdXREYXRhLmpzIiwid2VicGFjazovL3RkYWdsYS8uL3NyYy91dGlscy9NYXBVdGlscy5qcyIsIndlYnBhY2s6Ly90ZGFnbGEvLi9zcmMvYWxnby9UREFHTGF5b3V0QWxnby5qcyIsIndlYnBhY2s6Ly90ZGFnbGEvLi9zcmMvYWxnby9UZGFnLmpzIiwid2VicGFjazovL3RkYWdsYS8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJ0ZGFnbGFcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1widGRhZ2xhXCJdID0gZmFjdG9yeSgpO1xufSkoc2VsZiwgKCkgPT4ge1xucmV0dXJuICIsIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiLyoqXHJcbiAqIEB0ZW1wbGF0ZSBULCBVXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRWRnZSB7XHJcbiAgICAvKiogQHR5cGUge3N0cmluZ30gKi9cclxuICAgIGlkXHJcbiAgICAvKiogQHR5cGUge1V9ICovXHJcbiAgICBkYXRhXHJcbiAgICAvKiogQHR5cGUge05vZGU8VCwgVT59ICovXHJcbiAgICBzcmNcclxuICAgIC8qKiBAdHlwZSB7Tm9kZTxULCBVPn0gKi9cclxuICAgIGRzdFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtOb2RlPFQsIFU+fSBzcmNcclxuICAgICAqIEBwYXJhbSB7Tm9kZTxULCBVPn0gZHN0XHJcbiAgICAgKiBAcGFyYW0ge1V9IGRhdGFcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3Ioc3JjLCBkc3QsIGRhdGEgPSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5pZCA9IEVkZ2UuZ2V0RWRnZUlkKHNyYywgZHN0KVxyXG4gICAgICAgIHRoaXMuc3JjID0gc3JjXHJcbiAgICAgICAgdGhpcy5kc3QgPSBkc3RcclxuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge05vZGU8VCwgVT59IHNyY1xyXG4gICAgICogQHBhcmFtIHtOb2RlPFQsIFU+fSBkc3RcclxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBnZXRFZGdlSWQoc3JjLCBkc3QpIHtcclxuICAgICAgICByZXR1cm4gc3JjLmlkICsgJy0nICsgZHN0LmlkXHJcbiAgICB9XHJcbn1cclxuIiwiLyoqXHJcbiAqIEB0ZW1wbGF0ZSBUXHJcbiAqXHJcbiAqIEBwYXJhbSB7VFtdfSBhcnJheVxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKFQsVCk6bnVtYmVyfSBjb21wYXJhdG9yXHJcbiAqIEByZXR1cm5zIHtUfVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRNYXgoYXJyYXksIGNvbXBhcmF0b3IpIHtcclxuICAgIGxldCBtYXhJdGVtID0gYXJyYXlbMF07XHJcbiAgICBhcnJheS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgIGlmIChjb21wYXJhdG9yKGl0ZW0sIG1heEl0ZW0pID4gMCkge1xyXG4gICAgICAgICAgICBtYXhJdGVtID0gaXRlbTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIG1heEl0ZW07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAdGVtcGxhdGUgVFxyXG4gKlxyXG4gKiBAcGFyYW0ge1RbXX0gYXJyYXlcclxuICogQHBhcmFtIHtmdW5jdGlvbihULCBpKTpib29sZWFufSBwcmVkaWNhdGVcclxuICogQHJldHVybnMge1R9XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZmluZChhcnJheSwgcHJlZGljYXRlKSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gbnVsbDtcclxuICAgIGFycmF5LmZvckVhY2goKGl0ZW0sIGkpID0+IHtcclxuICAgICAgICBpZiAocHJlZGljYXRlKGl0ZW0sIGkpKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGl0ZW07XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAdGVtcGxhdGUgVFxyXG4gKlxyXG4gKiBAcGFyYW0ge1RbXX0gYXJyYXlcclxuICogQHBhcmFtIHtUfSBpdGVtXHJcbiAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUl0ZW1Gcm9tKGFycmF5LCBpdGVtKSB7XHJcbiAgICBsZXQgaW5kZXggPSBhcnJheS5pbmRleE9mKGl0ZW0pXHJcbiAgICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm4gZmFsc2VcclxuICAgIGFycmF5LnNwbGljZShpbmRleCwgMSlcclxuICAgIHJldHVybiB0cnVlXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBBcnJheVV0aWxzID0ge1xyXG4gICAgZmluZE1heCxcclxuICAgIGZpbmQsXHJcbiAgICByZW1vdmVJdGVtRnJvbSxcclxufVxyXG4iLCIvKipcclxuICogQHRlbXBsYXRlIFQsIFVcclxuICovXHJcbmV4cG9ydCBjbGFzcyBOb2RlIHtcclxuICAgIC8qKiBAdHlwZSB7KG51bWJlcnxzdHJpbmcpfSAqL1xyXG4gICAgaWRcclxuICAgIC8qKiBAdHlwZSB7VH0gKi9cclxuICAgIGRhdGFcclxuICAgIC8qKiBAdHlwZSB7RWRnZTxULCBVPltdfSAqL1xyXG4gICAgb3V0RWRnZXMgPSBbXVxyXG4gICAgLyoqIEB0eXBlIHtFZGdlPFQsIFU+W119ICovXHJcbiAgICBpbkVkZ2VzID0gW11cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7KG51bWJlcnxzdHJpbmcpfSBpZFxyXG4gICAgICogQHBhcmFtIHtUfSBkYXRhXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGlkLCBkYXRhID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuaWQgPSBpZFxyXG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGFcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQge3JlbW92ZUl0ZW1Gcm9tfSBmcm9tIFwiQC91dGlscy9BcnJheVV0aWxzXCJcclxuaW1wb3J0IHtFZGdlfSBmcm9tIFwiLi9FZGdlXCJcclxuaW1wb3J0IHtOb2RlfSBmcm9tIFwiLi9Ob2RlXCJcclxuXHJcbi8qKlxyXG4gKiBAdGVtcGxhdGUgVCwgVVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEdyYXBoIHtcclxuICAgIC8qKiBAdHlwZSB7Tm9kZTxULCBVPltdfSAqL1xyXG4gICAgbm9kZXMgPSBbXVxyXG4gICAgLyoqIEB0eXBlIHtNYXA8KG51bWJlcnxzdHJpbmcpLCBOb2RlPFQsIFU+Pn0gKi9cclxuICAgIG5vZGVNYXAgPSBuZXcgTWFwKClcclxuICAgIC8qKiBAdHlwZSB7RWRnZTxULCBVPltdfSAqL1xyXG4gICAgZWRnZXMgPSBbXVxyXG4gICAgLyoqIEB0eXBlIHtNYXA8c3RyaW5nLCBFZGdlPFQsIFU+Pn0gKi9cclxuICAgIGVkZ2VNYXAgPSBuZXcgTWFwKClcclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7KG51bWJlcnxzdHJpbmcpfSBpZFxyXG4gICAgICogQHBhcmFtIHtUfSBbZGF0YT1udWxsXVxyXG4gICAgICogQHJldHVybnMge05vZGU8VCwgVT59XHJcbiAgICAgKi9cclxuICAgIGFkZE5vZGUoaWQsIGRhdGEgPSBudWxsKSB7XHJcbiAgICAgICAgbGV0IG5vZGUgPSBuZXcgTm9kZShpZCwgZGF0YSlcclxuICAgICAgICB0aGlzLm5vZGVzLnB1c2gobm9kZSlcclxuICAgICAgICB0aGlzLm5vZGVNYXAuc2V0KGlkLCBub2RlKVxyXG4gICAgICAgIHJldHVybiBub2RlXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge05vZGU8VCwgVT59IG5vZGVcclxuICAgICAqL1xyXG4gICAgcmVtb3ZlTm9kZShub2RlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLm5vZGVNYXAuaGFzKG5vZGUuaWQpKSB7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuICAgICAgICByZW1vdmVJdGVtRnJvbSh0aGlzLm5vZGVzLCBub2RlKVxyXG4gICAgICAgIHRoaXMubm9kZU1hcC5kZWxldGUobm9kZS5pZClcclxuICAgICAgICBub2RlLmluRWRnZXMuY29uY2F0KG5vZGUub3V0RWRnZXMpXHJcbiAgICAgICAgICAgIC5mb3JFYWNoKGUgPT4gdGhpcy5yZW1vdmVFZGdlKGUpKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHsobnVtYmVyfHN0cmluZyl9IGlkXHJcbiAgICAgKi9cclxuICAgIHJlbW92ZU5vZGVCeUlkKGlkKSB7XHJcbiAgICAgICAgbGV0IG5vZGUgPSB0aGlzLm5vZGVNYXAuZ2V0KGlkKVxyXG4gICAgICAgIGlmICghbm9kZSkge1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZW1vdmVOb2RlKG5vZGUpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0geyhudW1iZXJ8c3RyaW5nKX0gc3JjSWRcclxuICAgICAqIEBwYXJhbSB7KG51bWJlcnxzdHJpbmcpfSBkc3RJZFxyXG4gICAgICogQHBhcmFtIHtVfSBbZGF0YT1udWxsXVxyXG4gICAgICogQHJldHVybnMge0VkZ2U8VCwgVT59XHJcbiAgICAgKi9cclxuICAgIGFkZEVkZ2Uoc3JjSWQsIGRzdElkLCBkYXRhID0gbnVsbCkge1xyXG4gICAgICAgIGxldCBzcmMgPSB0aGlzLm5vZGVNYXAuZ2V0KHNyY0lkKVxyXG4gICAgICAgIGxldCBkc3QgPSB0aGlzLm5vZGVNYXAuZ2V0KGRzdElkKVxyXG4gICAgICAgIGlmIChzcmMgPT09IHVuZGVmaW5lZCB8fCBkc3QgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGVkZ2UgPSBuZXcgRWRnZShzcmMsIGRzdCwgZGF0YSlcclxuXHJcbiAgICAgICAgc3JjLm91dEVkZ2VzLnB1c2goZWRnZSlcclxuICAgICAgICBkc3QuaW5FZGdlcy5wdXNoKGVkZ2UpXHJcbiAgICAgICAgdGhpcy5lZGdlcy5wdXNoKGVkZ2UpXHJcbiAgICAgICAgdGhpcy5lZGdlTWFwLnNldChlZGdlLmlkLCBlZGdlKVxyXG4gICAgICAgIHJldHVybiBlZGdlXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge0VkZ2U8VCwgVT59IGVkZ2VcclxuICAgICAqL1xyXG4gICAgcmVtb3ZlRWRnZShlZGdlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVkZ2VNYXAuaGFzKGVkZ2UuaWQpKSB7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuICAgICAgICByZW1vdmVJdGVtRnJvbSh0aGlzLmVkZ2VzLCBlZGdlKVxyXG4gICAgICAgIHRoaXMuZWRnZU1hcC5kZWxldGUoZWRnZS5pZClcclxuICAgICAgICByZW1vdmVJdGVtRnJvbShlZGdlLnNyYy5vdXRFZGdlcywgZWRnZSlcclxuICAgICAgICByZW1vdmVJdGVtRnJvbShlZGdlLmRzdC5pbkVkZ2VzLCBlZGdlKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGVkZ2VJZFxyXG4gICAgICovXHJcbiAgICByZW1vdmVFZGdlQnlJZChlZGdlSWQpIHtcclxuICAgICAgICBsZXQgZWRnZSA9IHRoaXMuZWRnZU1hcC5nZXQoZWRnZUlkKVxyXG4gICAgICAgIGlmICghZWRnZSkge1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZW1vdmVFZGdlKGVkZ2UpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcmV0dXJucyB7R3JhcGg8VCwgVT59XHJcbiAgICAgKi9cclxuICAgIGNvcHkoKSB7XHJcbiAgICAgICAgbGV0IGcgPSBuZXcgR3JhcGgoKVxyXG4gICAgICAgIHRoaXMubm9kZXMuZm9yRWFjaChuID0+IGcuYWRkTm9kZShuLmlkLCBuLmRhdGEpKVxyXG4gICAgICAgIHRoaXMuZWRnZXMuZm9yRWFjaChlID0+IGcuYWRkRWRnZShlLnNyYy5pZCwgZS5kc3QuaWQpKVxyXG4gICAgICAgIHJldHVybiBnXHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGNsYXNzIFZlcnRleExheW91dCB7XHJcbiAgICAvKiogQHR5cGUge251bWJlcn0gKi9cclxuICAgIHgwXHJcbiAgICAvKiogQHR5cGUge251bWJlcn0gKi9cclxuICAgIHgxXHJcbiAgICAvKiogQHR5cGUge251bWJlcn0gKi9cclxuICAgIHlcclxuICAgIC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuICAgIHJlbmRlclxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHgwXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0geDFcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHJlbmRlclxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcih4MCwgeDEsIHksIHJlbmRlcikge1xyXG4gICAgICAgIHRoaXMueDAgPSB4MFxyXG4gICAgICAgIHRoaXMueDEgPSB4MVxyXG4gICAgICAgIHRoaXMueSA9IHlcclxuICAgICAgICB0aGlzLnJlbmRlciA9IHJlbmRlclxyXG4gICAgfVxyXG59XHJcbiIsImV4cG9ydCBjbGFzcyBFZGdlTGF5b3V0IHtcclxuICAgIC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuICAgIGlzSGlkZGVuID0gZmFsc2U7XHJcbiAgICAvKiogQHR5cGUge251bWJlcnxudWxsfSAqL1xyXG4gICAgdHVybmluZ1ggPSBudWxsO1xyXG59XHJcbiIsIi8qKlxyXG4gKiBAdGVtcGxhdGUgSywgVlxyXG4gKlxyXG4gKiBAcGFyYW0ge01hcDxLLCBWPn0gbWFwXHJcbiAqIEBwYXJhbSB7S30ga2V5XHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb24oSyk6IFZ9IGNvbXB1dGVcclxuICogQHJldHVybnMge1Z9XHJcbiAqL1xyXG5mdW5jdGlvbiBjb21wdXRlSWZBYnNlbnQobWFwLCBrZXksIGNvbXB1dGUpIHtcclxuICAgIGlmIChtYXAuaGFzKGtleSkpIHtcclxuICAgICAgICByZXR1cm4gbWFwLmdldChrZXkpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdmFsdWUgPSBjb21wdXRlKGtleSk7XHJcbiAgICBtYXAuc2V0KGtleSwgdmFsdWUpO1xyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgTWFwVXRpbHMgPSB7XHJcbiAgICBjb21wdXRlSWZBYnNlbnQsXHJcbn1cclxuIiwiaW1wb3J0IHtFZGdlfSBmcm9tIFwiQC9ncmFwaFwiO1xyXG5pbXBvcnQge01hcFV0aWxzfSBmcm9tIFwiQC91dGlscy9NYXBVdGlsc1wiO1xyXG5pbXBvcnQge0FycmF5VXRpbHN9IGZyb20gXCJAL3V0aWxzL0FycmF5VXRpbHNcIjtcclxuXHJcbi8qKlxyXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdAL2dyYXBoJykuTm9kZTxWZXJ0ZXhMYXlvdXQsIEVkZ2VMYXlvdXQ+fSBUREFHTGF5b3V0QWxnb35Ob2RlXHJcbiAqL1xyXG5cclxuZXhwb3J0IGNsYXNzIFREQUdMYXlvdXRBbGdvIHtcclxuICAgIC8qKiBAdHlwZSB7KG51bWJlciB8IHN0cmluZyl9ICovXHJcbiAgICByb290SWRcclxuICAgIC8qKiBAdHlwZSB7R3JhcGg8VmVydGV4TGF5b3V0LCBFZGdlTGF5b3V0Pn0gKi9cclxuICAgIGdyYXBoXHJcbiAgICAvKiogQHR5cGUge251bWJlcn0gKi9cclxuICAgIGdhcFxyXG5cclxuICAgIC8qKiBAdHlwZSB7U2V0PChudW1iZXJ8c3RyaW5nKT59ICovXHJcbiAgICB2aXNpdGVkU2V0XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0geyhzdHJpbmd8bnVtYmVyKX0gcm9vdElkXHJcbiAgICAgKiBAcGFyYW0ge0dyYXBoPFZlcnRleExheW91dCwgRWRnZUxheW91dD59IGdyYXBoXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZ2FwXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHJvb3RJZCwgZ3JhcGgsIGdhcCkge1xyXG4gICAgICAgIHRoaXMucm9vdElkID0gcm9vdElkXHJcbiAgICAgICAgdGhpcy5ncmFwaCA9IGdyYXBoXHJcbiAgICAgICAgdGhpcy5nYXAgPSBnYXA7XHJcbiAgICB9XHJcblxyXG4gICAgc29sdmUoKSB7XHJcbiAgICAgICAgdGhpcy5jb21wdXRlSGlkZGVuRWRnZVNldCgpO1xyXG4gICAgICAgIHRoaXMucmVvcmRlckluQW5kT3V0RWRnZXMoKTtcclxuICAgICAgICB0aGlzLnNldExpbmVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcHV0ZUhpZGRlbkVkZ2VTZXQoKSB7XHJcbiAgICAgICAgY29uc3QgbXVsdGlPdXROb2RlcyA9IHRoaXMuZ3JhcGgubm9kZXMuZmlsdGVyKG5vZGUgPT4gbm9kZS5vdXRFZGdlcy5sZW5ndGggPiAxKTtcclxuXHJcbiAgICAgICAgdGhpcy5ncmFwaC5lZGdlcy5mb3JFYWNoKGUgPT4gZS5kYXRhLmlzSGlkZGVuID0gZmFsc2UpO1xyXG5cclxuICAgICAgICBtdWx0aU91dE5vZGVzLmZvckVhY2goY3VyTm9kZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRzdE5vZGVzID0gY3VyTm9kZS5vdXRFZGdlcy5tYXAoZSA9PiBlLmRzdCk7XHJcbiAgICAgICAgICAgIC8vIGZpbmQgZHN0IG5vZGUgY2xvc2VzdCB0byBpdFxyXG4gICAgICAgICAgICBsZXQgY2xvc2VzdERzdE5vZGUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoZHN0Tm9kZXMuZXZlcnkobm9kZSA9PiAhbm9kZS5kYXRhLnJlbmRlcikpIHtcclxuICAgICAgICAgICAgICAgIC8vIGp1c3QgcGljayB0aGUgZmlyc3Qgb25lXHJcbiAgICAgICAgICAgICAgICBjbG9zZXN0RHN0Tm9kZSA9IGRzdE5vZGVzWzBdO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgY2xvc2VzdCBkc3Qgbm9kZVxyXG4gICAgICAgICAgICAgICAgZHN0Tm9kZXMuZm9yRWFjaChkc3ROb2RlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRzdE5vZGUuZGF0YS5yZW5kZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdERzdE5vZGUgPT09IG51bGwgfHwgY2xvc2VzdERzdE5vZGUuZGF0YS54MCA+IGRzdE5vZGUuZGF0YS54MCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RHN0Tm9kZSA9IGRzdE5vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VyTm9kZS5vdXRFZGdlcy5mb3JFYWNoKGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuZHN0ICE9PSBjbG9zZXN0RHN0Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGUuZGF0YS5pc0hpZGRlbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlb3JkZXJJbkFuZE91dEVkZ2VzKCkge1xyXG4gICAgICAgIGNvbnN0IHN1YlRyZWVTdGFydE1hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLnZpc2l0ZWRTZXQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQHBhcmFtIHtUREFHTGF5b3V0QWxnb35Ob2RlfSBub2RlXHJcbiAgICAgICAgICogQHJldHVybnMge251bWJlcn1cclxuICAgICAgICAgKi9cclxuICAgICAgICBjb25zdCBwcm9jZXNzU3ViVHJlZVN0YXJ0ID0gKG5vZGUpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudmlzaXRlZFNldC5oYXMobm9kZS5pZCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBJbmZpbml0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnZpc2l0ZWRTZXQuYWRkKG5vZGUuaWQpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHN0YXJ0ID0gbm9kZS5kYXRhLngwID8/IEluZmluaXR5O1xyXG4gICAgICAgICAgICBub2RlLmluRWRnZXNcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoZSA9PiAhZS5kYXRhLmlzSGlkZGVuKVxyXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRTdGFydCA9IHByb2Nlc3NTdWJUcmVlU3RhcnQoZS5zcmMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gTWF0aC5taW4oc3RhcnQsIGNoaWxkU3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgc3ViVHJlZVN0YXJ0TWFwLnNldChub2RlLmlkLCBzdGFydCk7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGFydDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvY2Vzc1N1YlRyZWVTdGFydCh0aGlzLmdyYXBoLm5vZGVNYXAuZ2V0KHRoaXMucm9vdElkKSk7XHJcblxyXG4gICAgICAgIHRoaXMuZ3JhcGgubm9kZXMuZm9yRWFjaChub2RlID0+IHtcclxuICAgICAgICAgICAgbm9kZS5pbkVkZ2VzLnNvcnQoKGUxLCBlMikgPT5cclxuICAgICAgICAgICAgICAgIHN1YlRyZWVTdGFydE1hcC5nZXQoZTEuc3JjLmlkKSAtIHN1YlRyZWVTdGFydE1hcC5nZXQoZTIuc3JjLmlkKSk7XHJcbiAgICAgICAgICAgIG5vZGUub3V0RWRnZXMuc29ydCgoZTEsIGUyKSA9PlxyXG4gICAgICAgICAgICAgICAgc3ViVHJlZVN0YXJ0TWFwLmdldChlMS5zcmMuaWQpIC0gc3ViVHJlZVN0YXJ0TWFwLmdldChlMi5zcmMuaWQpKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHNldExpbmVzKCkge1xyXG4gICAgICAgIHRoaXMudmlzaXRlZFNldCA9IG5ldyBTZXQoKTtcclxuICAgICAgICBjb25zdCB7bGluZU1hcH0gPSB0aGlzLmxheW91dFZlcnRleCh0aGlzLmdyYXBoLm5vZGVNYXAuZ2V0KHRoaXMucm9vdElkKSk7XHJcbiAgICAgICAgZm9yIChjb25zdCBub2RlSWQgb2YgbGluZU1hcC5rZXlzKCkpIHtcclxuICAgICAgICAgICAgY29uc3QgbGluZSA9IGxpbmVNYXAuZ2V0KG5vZGVJZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLmdyYXBoLm5vZGVNYXAuZ2V0KG5vZGVJZCk7XHJcbiAgICAgICAgICAgIG5vZGUuZGF0YS55ID0gbGluZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBSZWN1cnNpb25SZXR1cm5PYmplY3RcclxuICAgICAqIEBwcm9wZXJ0eSB7TWFwPChudW1iZXJ8c3RyaW5nKSwgbnVtYmVyPn0gbGluZU1hcFxyXG4gICAgICogQHByb3BlcnR5IHtNYXA8bnVtYmVyLCBUREFHTGF5b3V0QWxnb35Ob2RlW10+fSBibG9ja3NNYXBcclxuICAgICAqL1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3VidHJlZSBzdGFydCBmaXJzdCArIHNjb3JlLWJhc2VkIHJvb3QgcGxhY2UgKyBjb21wcmVzc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7VERBR0xheW91dEFsZ29+Tm9kZX0gbm9kZVxyXG4gICAgICogQHJldHVybnMge1JlY3Vyc2lvblJldHVybk9iamVjdH1cclxuICAgICAqL1xyXG4gICAgbGF5b3V0VmVydGV4KG5vZGUpIHtcclxuICAgICAgICAvKiogQHR5cGUge01hcDwobnVtYmVyfHN0cmluZyksIG51bWJlcj59ICovXHJcbiAgICAgICAgY29uc3QgbG9jYWxMaW5lTWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIC8qKiBAdHlwZSB7TWFwPG51bWJlciwgVERBR0xheW91dEFsZ29+Tm9kZVtdPn0gKi9cclxuICAgICAgICBjb25zdCBsb2NhbEJsb2Nrc01hcCA9IG5ldyBNYXAoKTtcclxuXHJcbiAgICAgICAgLyoqIEB0eXBlIHtUREFHTGF5b3V0QWxnb35Ob2RlW119ICovXHJcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBub2RlLmluRWRnZXNcclxuICAgICAgICAgICAgLmZpbHRlcihlID0+ICFlLmRhdGEuaXNIaWRkZW4pXHJcbiAgICAgICAgICAgIC5tYXAoZSA9PiBlLnNyYyk7XHJcblxyXG4gICAgICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgaWYgKG5vZGUuZGF0YS5yZW5kZXIpIHtcclxuICAgICAgICAgICAgICAgIGxvY2FsTGluZU1hcC5zZXQobm9kZS5pZCwgMCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBibG9ja3MgPSBNYXBVdGlscy5jb21wdXRlSWZBYnNlbnQobG9jYWxCbG9ja3NNYXAsIDAsICgpID0+IFtdKTtcclxuICAgICAgICAgICAgICAgIGJsb2Nrcy5wdXNoKG5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB7bGluZU1hcDogbG9jYWxMaW5lTWFwLCBibG9ja3NNYXA6IGxvY2FsQmxvY2tzTWFwfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBsYXN0VmFsaWRDaGlsZCA9IG51bGw7XHJcbiAgICAgICAgbGV0IGxhc3RWYWxpZFJlc3VsdE9iamVjdCA9IG51bGw7XHJcblxyXG4gICAgICAgIGxldCBjaGlsZFN0YXJ0TGluZSA9IDA7XHJcbiAgICAgICAgZm9yKGxldCBjaGlsZElkeCA9IDA7IGNoaWxkSWR4IDwgY2hpbGRyZW4ubGVuZ3RoOyArK2NoaWxkSWR4KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5bY2hpbGRJZHhdO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMudmlzaXRlZFNldC5oYXMoY2hpbGQuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnZpc2l0ZWRTZXQuYWRkKGNoaWxkLmlkKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGxheW91dCBjaGlsZFxyXG4gICAgICAgICAgICBjb25zdCB7bGluZU1hcDogc3ViTGluZU1hcCwgYmxvY2tzTWFwOiBzdWJCbG9ja3NNYXB9ID0gdGhpcy5sYXlvdXRWZXJ0ZXgoY2hpbGQpO1xyXG4gICAgICAgICAgICBpZiAoc3ViTGluZU1hcC5zaXplID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBzdWJNaW5MaW5lID0gTWF0aC5taW4oLi4uc3ViTGluZU1hcC52YWx1ZXMoKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHN1Yk1heExpbmUgPSBNYXRoLm1heCguLi5zdWJMaW5lTWFwLnZhbHVlcygpKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbXB1dGUgYW5kIG9wdGltaXplIGxpbmUgb2Zmc2V0XHJcbiAgICAgICAgICAgIGxldCBjb21wcmVzc2VkU3RhcnRMaW5lID0gY2hpbGRTdGFydExpbmU7XHJcbiAgICAgICAgICAgIGlmIChsYXN0VmFsaWRDaGlsZCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGFzdENoaWxkTGluZSA9IGxvY2FsTGluZU1hcC5nZXQobGFzdFZhbGlkQ2hpbGQuaWQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY3VyQ2hpbGRMaW5lSW5TdWIgPSBzdWJMaW5lTWFwLmdldChjaGlsZC5pZCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsaWRTdGFydExpbmUgPSBjb21wcmVzc2VkU3RhcnRMaW5lOyAgICAgLy8gdGhlIHNtYWxsZXN0IHZhbGlkIGxpbmVcclxuICAgICAgICAgICAgICAgIGxldCB0ZXN0U3RhcnRMaW5lID0gY29tcHJlc3NlZFN0YXJ0TGluZTsgICAgICAvLyB0aGUgY2FuZGlkYXRlIGZvciB0ZXN0XHJcbiAgICAgICAgICAgICAgICBpbmNyZWFzZUxpbmVPZmZzZXQ6XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC0tdGVzdFN0YXJ0TGluZTsgICAgICAgIC8vIHRyeSB0byBtb3ZlIHVwXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViMkxvY2FsID0gbGluZUluU3ViID0+IGxpbmVJblN1YiAtIHN1Yk1pbkxpbmUgKyB0ZXN0U3RhcnRMaW5lO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsMlN1YiA9IGxpbmVJbkxvY2FsID0+IGxpbmVJbkxvY2FsICsgc3ViTWluTGluZSAtIHRlc3RTdGFydExpbmU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciBsYXN0IGNoaWxkIGlzIGFib3ZlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YjJMb2NhbChjdXJDaGlsZExpbmVJblN1YikgPD0gbGFzdENoaWxkTGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgdGVzdExpbmUgPSBzdWIyTG9jYWwoc3ViTWluTGluZSk7IHRlc3RMaW5lIDwgY2hpbGRTdGFydExpbmU7IHRlc3RMaW5lKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvY2tzMCA9IGxvY2FsQmxvY2tzTWFwLmdldCh0ZXN0TGluZSkgPz8gW107ICAgLy8gY2FuJ3QgYmUgbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGlsZHJlbiBibG9ja3MgaGF2ZW4ndCBzZXQgaW50byBsb2NhbCBzY29wZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9ja3MxID0gc3ViQmxvY2tzTWFwLmdldChsb2NhbDJTdWIodGVzdExpbmUpKSA/PyBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBiMCBvZiBibG9ja3MwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGIxIG9mIGJsb2NrczEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc092ZXJsYXBwZWRDb25zaWRlclR1cm5pbmdYKGIwLCBiMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5jcmVhc2VMaW5lT2Zmc2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhIHNwZWNpYWwgY2FzZTogYjAgaXMgbGFzdENoaWxkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RWYWxpZENoaWxkID09PSBiMCAmJiBiMS5kYXRhLnR1cm5pbmdYIDwgYjAuZGF0YS54MCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiMS5kYXRhLnR1cm5pbmdYICE9PSBudWxsLCBhcyBpdCBpcyBhIHByZWN1cnNvciBvZiBjdXIgY2hpbGQuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGluY3JlYXNlTGluZU9mZnNldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRTdGFydExpbmUgPSB0ZXN0U3RhcnRMaW5lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29tcHJlc3NlZFN0YXJ0TGluZSA9IHZhbGlkU3RhcnRMaW5lO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvKiBtZXJnZSBsaW5lIHJlc3VsdCAqL1xyXG5cclxuICAgICAgICAgICAgLy8gc3ViTGluZUNudCA9IHN1Yk1heExpbmUgLSBzdWJNaW5MaW5lICsgMTtcclxuICAgICAgICAgICAgLy8gbWFwIFtzdWJNaW5MaW5lLCBzdWJNYXhMaW5lXSAtPiBbY29tcHJlc3NlZFN0YXJ0TGluZSwgY29tcHJlc3NlZFN0YXJ0TGluZSArIHN1YkxpbmVDbnQgLSAxXVxyXG4gICAgICAgICAgICBjb25zdCBzdWIyTG9jYWwgPSBsaW5lSW5TdWIgPT4gbGluZUluU3ViIC0gc3ViTWluTGluZSArIGNvbXByZXNzZWRTdGFydExpbmU7XHJcblxyXG4gICAgICAgICAgICAvLyB1cGRhdGUgbG9jYWwgbGluZSBtYXBcclxuICAgICAgICAgICAgZm9yIChjb25zdCBbcHJlY3Vyc29ySWQsIGxpbmVJblN1Yl0gb2Ygc3ViTGluZU1hcC5lbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVJbkxvY2FsID0gc3ViMkxvY2FsKGxpbmVJblN1Yik7XHJcbiAgICAgICAgICAgICAgICBsb2NhbExpbmVNYXAuc2V0KHByZWN1cnNvcklkLCBsaW5lSW5Mb2NhbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHVwZGF0ZSBsb2NhbCBibG9ja3MgbWFwXHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2xpbmVJblN1Yiwgc3ViQmxvY2tzXSBvZiBzdWJCbG9ja3NNYXAuZW50cmllcygpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5lSW5Mb2NhbCA9IHN1YjJMb2NhbChsaW5lSW5TdWIpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYmxvY2tzID0gTWFwVXRpbHMuY29tcHV0ZUlmQWJzZW50KGxvY2FsQmxvY2tzTWFwLCBsaW5lSW5Mb2NhbCwgKCkgPT4gW10pO1xyXG4gICAgICAgICAgICAgICAgYmxvY2tzLnB1c2goLi4uc3ViQmxvY2tzKTtcclxuICAgICAgICAgICAgICAgIC8vIGJsb2Nrcy5zb3J0KChiMCwgYjEpID0+IGIwLmRhdGEueDAgLSBiMC5kYXRhLngxKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gdXBkYXRlIGNoaWxkU3RhcnRMaW5lXHJcbiAgICAgICAgICAgIGNoaWxkU3RhcnRMaW5lID0gc3ViMkxvY2FsKHN1Yk1heExpbmUpICsgMTtcclxuXHJcbiAgICAgICAgICAgIGxhc3RWYWxpZENoaWxkID0gY2hpbGQ7XHJcbiAgICAgICAgICAgIGxhc3RWYWxpZFJlc3VsdE9iamVjdCA9IHtsaW5lTWFwOiBzdWJMaW5lTWFwLCBibG9ja3NNYXA6IHN1YkJsb2Nrc01hcH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKiBmaW5kIGEgbGluZSBmb3IgY3VycmVudCBub2RlICovXHJcblxyXG4gICAgICAgIGlmIChub2RlLmRhdGEucmVuZGVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1heExpbmUgPSBNYXRoLm1heCguLi5sb2NhbExpbmVNYXAudmFsdWVzKCkpO1xyXG4gICAgICAgICAgICBsZXQgbWluU2NvcmUgPSBJbmZpbml0eTtcclxuICAgICAgICAgICAgbGV0IGJlc3RMaW5lID0gLTI7XHJcblxyXG4gICAgICAgICAgICAvKiogQHR5cGUge1REQUdMYXlvdXRBbGdvfk5vZGVbXVtdIHwgbnVsbH0gKi9cclxuICAgICAgICAgICAgbGV0IGJlc3RHcm91cHMgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IobGV0IHRlc3RMaW5lID0gLTE7IHRlc3RMaW5lIDw9IG1heExpbmUgKyAxOyArK3Rlc3RMaW5lKSB7ICAgICAgLy8gaSBpcyBsaW5lSWR4IGFzIHdlbGxcclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IGJsb2NrcyA9IE1hcFV0aWxzLmNvbXB1dGVJZkFic2VudChsb2NhbEJsb2Nrc01hcCwgdGVzdExpbmUsICgpID0+IFtdKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJsb2NrcyA9IGxvY2FsQmxvY2tzTWFwLmdldCh0ZXN0TGluZSkgPz8gW107XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkID0gYmxvY2tzLmV2ZXJ5KHRlc3ROb2RlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuaXNPdmVybGFwcGVkKHRlc3ROb2RlLCBub2RlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY29tcHV0ZSBzY29yZVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwcyA9IHRoaXMuY29tcHV0ZUNoaWxkcmVuR3JvdXBzKGxvY2FsTGluZU1hcCwgbm9kZSwgY2hpbGRyZW4sIHRlc3RMaW5lKTtcclxuICAgICAgICAgICAgICAgIGxldCBjb3N0ID0gMDtcclxuICAgICAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKChncm91cCwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChncm91cC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4RW5kID0gTWF0aC5tYXgoLi4uZ3JvdXAubWFwKGNoaWxkID0+IGNoaWxkLmRhdGEueDEpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXAuZm9yRWFjaChjaGlsZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvc3QgKz0gdGhpcy5jb21wdXRlRWRnZUNvc3QoY2hpbGQuZGF0YS54MSwgbG9jYWxMaW5lTWFwLmdldChjaGlsZC5pZCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhFbmQgKyB0aGlzLmdhcCwgdGVzdExpbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAxKSB7ICAgICAgLy8gbWlkZGxlIHBhcnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29zdCArPSB0aGlzLmNvbXB1dGVFZGdlQ29zdChtYXhFbmQsIHRlc3RMaW5lLCBub2RlLmRhdGEueDAsIHRlc3RMaW5lKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkQ2VudGVyWSA9IGNoaWxkcmVuLnJlZHVjZSgoc3VtLCBjaGlsZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyBsb2NhbExpbmVNYXAuZ2V0KGNoaWxkLmlkKTtcclxuICAgICAgICAgICAgICAgIH0sIDApIC8gY2hpbGRyZW4ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgY29zdCArPSBNYXRoLmFicyhjaGlsZENlbnRlclkgLSB0ZXN0TGluZSkgKiBjaGlsZHJlbi5sZW5ndGggKiBDSElMRF9DRU5URVJfWV9ESVNUX1BFTkFMVFk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGdyb3Vwc1swXS5sZW5ndGggIT09IDBcclxuICAgICAgICAgICAgICAgICAgICAmJiBNYXRoLm1pbiguLi5ncm91cHNbMF0ubWFwKGNoaWxkID0+IGNoaWxkLmRhdGEueDApKSA+IG5vZGUuZGF0YS54MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvc3QgKz0gSW5maW5pdHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvc3QgPCBtaW5TY29yZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1pblNjb3JlID0gY29zdDtcclxuICAgICAgICAgICAgICAgICAgICBiZXN0TGluZSA9IHRlc3RMaW5lO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlc3RHcm91cHMgPSBncm91cHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGJlc3RMaW5lID09PSAtMikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignbGF5b3V0IGVycm9yJywgdGhpcywgbm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGJlc3RMaW5lID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgYmVzdExpbmUgPSAwO1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBbcHJlY3Vyc29ySWQsIGxpbmVdIG9mIGxvY2FsTGluZU1hcC5lbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbExpbmVNYXAuc2V0KHByZWN1cnNvcklkLCBsaW5lICsgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wTWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxCbG9ja3NNYXAuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4gdGVtcE1hcC5zZXQoa2V5LCB2YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxCbG9ja3NNYXAuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIHRlbXBNYXAuZm9yRWFjaCgoYmxvY2tzLCBsaW5lKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxCbG9ja3NNYXAuc2V0KGxpbmUgKyAxLCBibG9ja3MpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdsYXN0IGNob2ljZScsIGJlc3RMaW5lKTtcclxuICAgICAgICAgICAgbG9jYWxMaW5lTWFwLnNldChub2RlLmlkLCBiZXN0TGluZSk7XHJcbiAgICAgICAgICAgIE1hcFV0aWxzLmNvbXB1dGVJZkFic2VudChsb2NhbEJsb2Nrc01hcCwgYmVzdExpbmUsICgpID0+IFtdKS5wdXNoKG5vZGUpO1xyXG5cclxuICAgICAgICAgICAgLyogc2V0IGVkZ2UgdHVybmluZyBwb2ludCAqL1xyXG5cclxuICAgICAgICAgICAgYmVzdEdyb3Vwcy5mb3JFYWNoKChncm91cCwgaSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHR1cm5pbmdYO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbWF4RW5kID0gTWF0aC5tYXgoLi4uZ3JvdXAubWFwKGNoaWxkID0+IGNoaWxkLmRhdGEueDEpKTtcclxuICAgICAgICAgICAgICAgIHR1cm5pbmdYID0gTWF0aC5taW4obWF4RW5kICsgdGhpcy5nYXAgLyAyLCBub2RlLmRhdGEueDEpO1xyXG4gICAgICAgICAgICAgICAgZ3JvdXAuZm9yRWFjaChjaGlsZCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWRnZSA9IHRoaXMuZ3JhcGguZWRnZU1hcC5nZXQoRWRnZS5nZXRFZGdlSWQoY2hpbGQsIG5vZGUpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVkZ2UuZGF0YS5pc0hpZGRlbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmVzdExpbmUgPT09IGxvY2FsTGluZU1hcC5nZXQoY2hpbGQuaWQpKSB7ICAgICAgLy8gb24gdGhlIHNhbWUgbGluZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRnZS5kYXRhLnR1cm5pbmdYID0gbm9kZS5kYXRhLngwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IDEpIHsgICAgICAgLy8gbWlkZGxlIGdyb3VwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiYXNpYyBzb2x1dGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWRnZS5kYXRhLnR1cm5pbmdYID0gbm9kZS5kYXRhLngwIC0gdGhpcy5nYXA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiYXNpYyBzb2x1dGlvbiAyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlZGdlLmRhdGEudHVybmluZ1ggPSAodHVybmluZ1ggKyBub2RlLmRhdGEueDApIC8gMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvcHRpbWl6ZWQgc29sdXRpb24gKHNsb3cpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiogQHR5cGUge1REQUdMYXlvdXRBbGdvfk5vZGVbXX0gKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3ROb2Rlc0luRWFjaExpbmUgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gbG9jYWxMaW5lTWFwLmdldChjaGlsZC5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBsaW5lID0gTWF0aC5taW4oc3RhcnQsIGJlc3RMaW5lKTsgbGluZSA8PSBNYXRoLm1heChzdGFydCwgYmVzdExpbmUpOyArK2xpbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub2Rlc09uVGhlTGVmdCA9IGxvY2FsQmxvY2tzTWFwLmdldChsaW5lKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGIgPT4gYi5kYXRhLngwIDwgbm9kZS5kYXRhLngwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0Tm9kZSA9IEFycmF5VXRpbHMuZmluZE1heChub2Rlc09uVGhlTGVmdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHAsIHEpID0+IHAuZGF0YS54MCAtIHEuZGF0YS54MCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3ROb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROb2Rlc0luRWFjaExpbmUucHVzaChsYXN0Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVuZFBvaW50ID0gbWF4RW5kO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3ROb2Rlc0luRWFjaExpbmUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKiBAdHlwZSB7bnVtYmVyW119ICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kUG9pbnRzID0gbGFzdE5vZGVzSW5FYWNoTGluZS5tYXAocHJlY3Vyc29yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZWRnZSA9IHByZWN1cnNvci5vdXRFZGdlcy5maW5kKGUgPT4gIWUuZGF0YS5pc0hpZGRlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGdlLmRhdGEudHVybmluZ1ggJiYgZWRnZS5kc3QgIT09IG5vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlZGdlLmRhdGEudHVybmluZ1g7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJlY3Vyc29yLmRhdGEueDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRQb2ludCA9IE1hdGgubWF4KC4uLmVuZFBvaW50cykgKyB0aGlzLmdhcCAvIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGdlLmRhdGEudHVybmluZ1ggPSAoZW5kUG9pbnQgKyBub2RlLmRhdGEueDApIC8gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkZ2UuZGF0YS50dXJuaW5nWCA9IHR1cm5pbmdYO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBub3QgdG8gcmVuZGVyIHRoaXMgbm9kZVxyXG4gICAgICAgICAgICBsZXQgbm9kZVdpdGhNYXhFbmQgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHByZWN1cnNvcklkIG9mIGxvY2FsTGluZU1hcC5rZXlzKCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHByZWN1cnNvciA9IHRoaXMuZ3JhcGgubm9kZU1hcC5nZXQocHJlY3Vyc29ySWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGVXaXRoTWF4RW5kID09PSBudWxsIHx8IHByZWN1cnNvci5kYXRhLngxID4gbm9kZVdpdGhNYXhFbmQuZGF0YS54MSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGVXaXRoTWF4RW5kID0gcHJlY3Vyc29yO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChub2RlV2l0aE1heEVuZCAhPT0gbnVsbCkgeyAgICAgIC8vIGxvY2FsTGluZU1hcC5zaXplICE9PSAwXHJcbiAgICAgICAgICAgICAgICBub2RlLmRhdGEueDAgPSBub2RlLmRhdGEueDEgPSBub2RlV2l0aE1heEVuZC5kYXRhLngxO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGluZSA9IGxvY2FsTGluZU1hcC5nZXQobm9kZVdpdGhNYXhFbmQuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdsYXN0IGNob2ljZScsIGJlc3RMaW5lKTtcclxuICAgICAgICAgICAgICAgIGxvY2FsTGluZU1hcC5zZXQobm9kZS5pZCwgbGluZSk7XHJcbiAgICAgICAgICAgICAgICBNYXBVdGlscy5jb21wdXRlSWZBYnNlbnQobG9jYWxCbG9ja3NNYXAsIGxpbmUsICgpID0+IFtdKS5wdXNoKG5vZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qIHNldCBlZGdlIHR1cm5pbmcgcG9pbnQgKi9cclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSB0aGlzLmdyYXBoLmVkZ2VNYXAuZ2V0KEVkZ2UuZ2V0RWRnZUlkKGNoaWxkLCBub2RlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWRnZS5kYXRhLnR1cm5pbmdYID0gbm9kZS5kYXRhLngwO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7bGluZU1hcDogbG9jYWxMaW5lTWFwLCBibG9ja3NNYXA6IGxvY2FsQmxvY2tzTWFwfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7VERBR0xheW91dEFsZ29+Tm9kZX0gbm9kZTBcclxuICAgICAqIEBwYXJhbSB7VERBR0xheW91dEFsZ29+Tm9kZX0gbm9kZTFcclxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICovXHJcbiAgICBpc092ZXJsYXBwZWQobm9kZTAsIG5vZGUxKSB7XHJcbiAgICAgICAgY29uc3Qgc3RhcnQwID0gbm9kZTAuZGF0YS54MCwgZW5kMCA9IG5vZGUwLmRhdGEueDEgKyB0aGlzLmdhcDtcclxuICAgICAgICBjb25zdCBzdGFydDEgPSBub2RlMS5kYXRhLngwLCBlbmQxID0gbm9kZTEuZGF0YS54MSArIHRoaXMuZ2FwO1xyXG4gICAgICAgIHJldHVybiAhKGVuZDAgPCBzdGFydDEgfHwgc3RhcnQwID4gZW5kMSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge1REQUdMYXlvdXRBbGdvfk5vZGV9IG5vZGUwXHJcbiAgICAgKiBAcGFyYW0ge1REQUdMYXlvdXRBbGdvfk5vZGV9IG5vZGUxXHJcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuICAgICAqL1xyXG4gICAgaXNPdmVybGFwcGVkQ29uc2lkZXJUdXJuaW5nWChub2RlMCwgbm9kZTEpIHtcclxuICAgICAgICBsZXQgc3RhcnQwID0gbm9kZTAuZGF0YS54MCwgZW5kMCA9IG5vZGUwLmRhdGEueDEgKyB0aGlzLmdhcDtcclxuICAgICAgICBsZXQgc3RhcnQxID0gbm9kZTEuZGF0YS54MCwgZW5kMSA9IG5vZGUxLmRhdGEueDEgKyB0aGlzLmdhcDtcclxuICAgICAgICBub2RlMC5vdXRFZGdlcy5mb3JFYWNoKGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZS5kYXRhLnR1cm5pbmdYICYmIGVuZDAgPCBlLmRhdGEudHVybmluZ1gpIHtcclxuICAgICAgICAgICAgICAgIGVuZDAgPSBlLmRhdGEudHVybmluZ1g7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBub2RlMS5vdXRFZGdlcy5mb3JFYWNoKGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZS5kYXRhLnR1cm5pbmdYICYmIGVuZDEgPCBlLmRhdGEudHVybmluZ1gpIHtcclxuICAgICAgICAgICAgICAgIGVuZDEgPSBlLmRhdGEudHVybmluZ1g7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gIShlbmQwIDwgc3RhcnQxIHx8IHN0YXJ0MCA+IGVuZDEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtNYXA8bnVtYmVyfHN0cmluZywgbnVtYmVyPn0gbGluZU1hcFxyXG4gICAgICogQHBhcmFtIHtUREFHTGF5b3V0QWxnb35Ob2RlfSBub2RlXHJcbiAgICAgKiBAcGFyYW0ge1REQUdMYXlvdXRBbGdvfk5vZGVbXX0gY2hpbGRyZW5cclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvcHRpb25hbExpbmUgTm9kZSBjYW4gYmUgcHV0IGhlcmVcclxuICAgICAqIEByZXR1cm5zIHtUREFHTGF5b3V0QWxnb35Ob2RlW11bXX1cclxuICAgICAqL1xyXG4gICAgY29tcHV0ZUNoaWxkcmVuR3JvdXBzKGxpbmVNYXAsIG5vZGUsIGNoaWxkcmVuLCBvcHRpb25hbExpbmUpIHtcclxuICAgICAgICBjb25zdCBvdmVybGFwcGVkQ2hpbGRyZW4gPSBjaGlsZHJlbi5maWx0ZXIoY2hpbGQgPT4gdGhpcy5pc092ZXJsYXBwZWQobm9kZSwgY2hpbGQpKTtcclxuXHJcbiAgICAgICAgLy8gZmluZCBsYXN0IG92ZXJsYXBwZWQgY2hpbGQgYWJvdmUgb3B0aW9uYWwgbGluZVxyXG4gICAgICAgIGNvbnN0IG92ZXJsYXBwZWRDaGlsZHJlbkFib3ZlID0gb3ZlcmxhcHBlZENoaWxkcmVuLmZpbHRlcihjaGlsZCA9PiBsaW5lTWFwLmdldChjaGlsZC5pZCkgPCBvcHRpb25hbExpbmUpO1xyXG4gICAgICAgIGNvbnN0IGxhc3RPdmVybGFwcGVkQWJvdmUgPSBvdmVybGFwcGVkQ2hpbGRyZW5BYm92ZVtvdmVybGFwcGVkQ2hpbGRyZW5BYm92ZS5sZW5ndGggLSAxXSA/PyBudWxsO1xyXG5cclxuICAgICAgICAvLyBmaW5kIGZpcnN0IG92ZXJsYXBwZWQgY2hpbGQgYmVsb3cgb3B0aW9uYWwgbGluZVxyXG4gICAgICAgIGNvbnN0IG92ZXJsYXBwZWRDaGlsZHJlbkJlbG93ID0gb3ZlcmxhcHBlZENoaWxkcmVuLmZpbHRlcihjaGlsZCA9PiBsaW5lTWFwLmdldChjaGlsZC5pZCkgPiBvcHRpb25hbExpbmUpO1xyXG4gICAgICAgIGNvbnN0IGZpcnN0T3ZlcmxhcHBlZEJlbG93ID0gb3ZlcmxhcHBlZENoaWxkcmVuQmVsb3dbMF0gPz8gbnVsbDtcclxuXHJcbiAgICAgICAgLy8gWzAsc2VnSW5kZXgwKSwgW3NlZ0luZGV4MCxzZWdJbmRleDEpLCBbc2VnSW5kZXgxLGxlbilcclxuICAgICAgICBsZXQgc2VnSW5kZXgwID0gMCwgc2VnSW5kZXgxID0gY2hpbGRyZW4ubGVuZ3RoO1xyXG4gICAgICAgIGlmIChsYXN0T3ZlcmxhcHBlZEFib3ZlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHNlZ0luZGV4MCA9IGNoaWxkcmVuLmluZGV4T2YobGFzdE92ZXJsYXBwZWRBYm92ZSkgKyAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZmlyc3RPdmVybGFwcGVkQmVsb3cgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgc2VnSW5kZXgxID0gY2hpbGRyZW4uaW5kZXhPZihmaXJzdE92ZXJsYXBwZWRCZWxvdyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGdyb3VwMCA9IGNoaWxkcmVuLmZpbHRlcigoXywgaSkgPT4gaSA8IHNlZ0luZGV4MCk7XHJcbiAgICAgICAgY29uc3QgZ3JvdXAxID0gY2hpbGRyZW4uZmlsdGVyKChfLCBpKSA9PiBzZWdJbmRleDAgPD0gaSAmJiBpIDwgc2VnSW5kZXgxKTtcclxuICAgICAgICBjb25zdCBncm91cDIgPSBjaGlsZHJlbi5maWx0ZXIoKF8sIGkpID0+IHNlZ0luZGV4MSA8PSBpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIFtncm91cDAsIGdyb3VwMSwgZ3JvdXAyXTtcclxuICAgIH1cclxuXHJcbiAgICBjb21wdXRlRWRnZUNvc3Qoc3JjWCwgc3JjWSwgZHN0WCwgZHN0WSkge1xyXG4gICAgICAgIGxldCBjb3N0ID0gMDtcclxuICAgICAgICBjb3N0ICs9IE1hdGguYWJzKHNyY1ggLSBkc3RYKSAvIHRoaXMuZ2FwICogWF9GQUNUT1I7XHJcbiAgICAgICAgY29zdCArPSBNYXRoLmFicyhzcmNZIC0gZHN0WSkgKiAoWV9GQUNUT1IgKyBZX1VQX1BFTkFMVFkgKiAoc3JjWSA8PSBkc3RZID8gMCA6IDEpKTtcclxuICAgICAgICByZXR1cm4gY29zdDtcclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgWF9GQUNUT1IgPSAxO1xyXG5jb25zdCBZX0ZBQ1RPUiA9IDE7XHJcbmNvbnN0IFlfVVBfUEVOQUxUWSA9IDAuMDU7XHJcbmNvbnN0IENISUxEX0NFTlRFUl9ZX0RJU1RfUEVOQUxUWSA9IDAuMDQ7XHJcbi8vIGNvbnN0IENISUxEX0NFTlRFUl9ZX0RJU1RfUEVOQUxUWSA9IDA7XHJcbiIsImltcG9ydCB7RWRnZSwgR3JhcGh9IGZyb20gXCJAL2dyYXBoXCI7XHJcbmltcG9ydCB7VmVydGV4TGF5b3V0fSBmcm9tIFwiQC9hbGdvL1ZlcnRleExheW91dERhdGFcIjtcclxuaW1wb3J0IHtFZGdlTGF5b3V0fSBmcm9tIFwiQC9hbGdvL0VkZ2VMYXlvdXREYXRhXCI7XHJcbmltcG9ydCB7VERBR0xheW91dEFsZ299IGZyb20gXCJAL2FsZ28vVERBR0xheW91dEFsZ29cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBUZGFnIHtcclxuXHJcbiAgICAvKiogQHR5cGUge0dyYXBoPFZlcnRleExheW91dCwgRWRnZUxheW91dD59ICovXHJcbiAgICBfZ3JhcGg7XHJcblxyXG4gICAgLyogc2V0dGluZ3MgKi9cclxuXHJcbiAgICAvKiogQHR5cGUge251bWJlcn0gKi9cclxuICAgIF9nYXAgPSAyMDtcclxuICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG4gICAgX2xpbmVIZWlnaHQgPSAxMDtcclxuICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG4gICAgX2xpbmVTcGFjZSA9IDQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5fZ3JhcGggPSBuZXcgR3JhcGgoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7KG51bWJlciB8IHN0cmluZyl9IGlkXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0geDBcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB4MVxyXG4gICAgICogQHBhcmFtIHtib29sZWFufSByZW5kZXJcclxuICAgICAqL1xyXG4gICAgc2V0Tm9kZSh7aWQsIHgwLCB4MSwgcmVuZGVyPXRydWV9KSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IG5ldyBWZXJ0ZXhMYXlvdXQoeDAsIHgxLCAwLCByZW5kZXIpO1xyXG4gICAgICAgIHRoaXMuX2dyYXBoLmFkZE5vZGUoaWQsIGRhdGEpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7KG51bWJlciB8IHN0cmluZyl9IHNyY1xyXG4gICAgICogQHBhcmFtIHsobnVtYmVyIHwgc3RyaW5nKX0gZHN0XHJcbiAgICAgKi9cclxuICAgIHNldEVkZ2Uoe3NyYywgZHN0fSkge1xyXG4gICAgICAgIGlmICghdGhpcy5fZ3JhcGgubm9kZU1hcC5oYXMoc3JjKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCd0ZGFnbGE6IENhblxcJ3QgZmluZCBub2RlICcgKyBzcmMgKyAnLiBJZ25vcmVkLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLl9ncmFwaC5ub2RlTWFwLmhhcyhkc3QpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3RkYWdsYTogQ2FuXFwndCBmaW5kIG5vZGUgJyArIGRzdCArICcuIElnbm9yZWQuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBkYXRhID0gbmV3IEVkZ2VMYXlvdXQoKVxyXG4gICAgICAgIHRoaXMuX2dyYXBoLmFkZEVkZ2Uoc3JjLCBkc3QsIGRhdGEpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBpZFxyXG4gICAgICogQHJldHVybnMge251bGx8T2JqZWN0fVxyXG4gICAgICovXHJcbiAgICBnZXROb2RlKGlkKSB7XHJcbiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuX2dyYXBoLm5vZGVNYXAuZ2V0KGlkKTtcclxuICAgICAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGlkOiBub2RlLmlkLFxyXG4gICAgICAgICAgICB4OiBub2RlLmRhdGEueDAsXHJcbiAgICAgICAgICAgIHk6IHRoaXMuX2dldFlUb3Aobm9kZS5kYXRhLnkpLFxyXG4gICAgICAgICAgICB4MDogbm9kZS5kYXRhLngwLFxyXG4gICAgICAgICAgICB4MTogbm9kZS5kYXRhLngxLFxyXG4gICAgICAgICAgICB3aWR0aDogbm9kZS5kYXRhLngxIC0gbm9kZS5kYXRhLngwLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuX2xpbmVIZWlnaHQsXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEByZXR1cm5zIHsobnVsbHxPYmplY3QpW119XHJcbiAgICAgKi9cclxuICAgIGdldE5vZGVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ncmFwaC5ub2Rlcy5tYXAobm9kZSA9PiB0aGlzLmdldE5vZGUobm9kZS5pZCkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHsobnVtYmVyIHwgc3RyaW5nKX0gc3JjXHJcbiAgICAgKiBAcGFyYW0geyhudW1iZXIgfCBzdHJpbmcpfSBkc3RcclxuICAgICAqIEByZXR1cm5zIHtudWxsfE9iamVjdH1cclxuICAgICAqL1xyXG4gICAgZ2V0RWRnZShzcmMsIGRzdCkge1xyXG4gICAgICAgIGNvbnN0IHNyY05vZGUgPSB0aGlzLl9ncmFwaC5ub2RlTWFwLmdldChzcmMpO1xyXG4gICAgICAgIGNvbnN0IGRzdE5vZGUgPSB0aGlzLl9ncmFwaC5ub2RlTWFwLmdldChkc3QpO1xyXG4gICAgICAgIGlmICghc3JjTm9kZSB8fCAhZHN0Tm9kZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgZWRnZSA9IHRoaXMuX2dyYXBoLmVkZ2VNYXAuZ2V0KEVkZ2UuZ2V0RWRnZUlkKHNyY05vZGUsIGRzdE5vZGUpKTtcclxuICAgICAgICBpZiAoIWVkZ2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwb2ludHMgPSB0aGlzLl9nZXRFZGdlUG9pbnRzKGVkZ2UpXHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGlkOiBlZGdlLmlkLFxyXG4gICAgICAgICAgICBzcmM6IGVkZ2Uuc3JjLmlkLFxyXG4gICAgICAgICAgICBkc3Q6IGVkZ2UuZHN0LmlkLFxyXG4gICAgICAgICAgICByZW5kZXI6IHNyY05vZGUuZGF0YS5yZW5kZXIgJiYgZHN0Tm9kZS5kYXRhLnJlbmRlcixcclxuICAgICAgICAgICAgcG9pbnRzLFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0geVxyXG4gICAgICogQHJldHVybnMge251bWJlcn1cclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKi9cclxuICAgIF9nZXRZVG9wKHkpIHtcclxuICAgICAgICByZXR1cm4geSAqICh0aGlzLl9saW5lSGVpZ2h0ICsgdGhpcy5fbGluZVNwYWNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqL1xyXG4gICAgX2dldFlDZW50ZXIoeSkge1xyXG4gICAgICAgIHJldHVybiB5ICogKHRoaXMuX2xpbmVIZWlnaHQgKyB0aGlzLl9saW5lU3BhY2UpICsgdGhpcy5fbGluZUhlaWdodCAvIDI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge0VkZ2U8VmVydGV4TGF5b3V0LCBFZGdlTGF5b3V0Pn0gZWRnZVxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqL1xyXG4gICAgX2dldEVkZ2VQb2ludHMoZWRnZSkge1xyXG4gICAgICAgIGNvbnN0IHNyYyA9IGVkZ2Uuc3JjLCBkc3QgPSBlZGdlLmRzdDtcclxuXHJcbiAgICAgICAgaWYgKCFzcmMuZGF0YS5yZW5kZXIgfHwgIWRzdC5kYXRhLnJlbmRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB4MCA9IHNyYy5kYXRhLngxO1xyXG4gICAgICAgIGNvbnN0IHgxID0gZHN0LmRhdGEueDA7XHJcbiAgICAgICAgY29uc3QgeDIgPSBkc3QuZGF0YS54MCArIHRoaXMuX2dhcDtcclxuICAgICAgICBjb25zdCB4MyA9IGRzdC5kYXRhLngxO1xyXG4gICAgICAgIGNvbnN0IHkwID0gdGhpcy5fZ2V0WUNlbnRlcihzcmMuZGF0YS55KTtcclxuICAgICAgICBjb25zdCB5MSA9IHRoaXMuX2dldFlDZW50ZXIoZHN0LmRhdGEueSk7XHJcbiAgICAgICAgY29uc3QgeTIgPSB5MSArIHRoaXMuX2dldE9mZnNldERzdFkoeTAsIHkxKTtcclxuXHJcbiAgICAgICAgaWYgKGVkZ2UuZGF0YS50dXJuaW5nWCA9PT0gZHN0LmRhdGEueDApIHtcclxuICAgICAgICAgICAgLy8gb24gdGhlIHNhbWUgbGluZVxyXG4gICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAgW3gwLCB5MF0sXHJcbiAgICAgICAgICAgICAgICBbeDEsIHkxXSxcclxuICAgICAgICAgICAgXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChlZGdlLmRhdGEuaXNIaWRkZW4pIHtcclxuICAgICAgICAgICAgLy8gdW5pbXBvcnRhbnQgYnJvYWRjYXN0IGVkZ2VcclxuICAgICAgICAgICAgaWYgKHgwID49IHgxICYmIHgyID49IHgzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB4MiBpcyBub3QgdmFsaWQgKHRvbyBuYXJyb3cgdG8gdGhlIGVuZCBvZiBkc3QpXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjeCA9ICh4MCArIHgzKSAvIDI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAgICAgIFt4MCwgeTBdLCBbY3gsIHkwXSxcclxuICAgICAgICAgICAgICAgICAgICBbY3gsIHkyXSwgW3gzLCB5Ml0sICAgICAvLyB1c2UgeDMgYW5kIHkyXHJcbiAgICAgICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHgwID49IHgxKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB4MSBpcyBub3QgdmFsaWQgYnV0IHgyIGlzIHZhbGlkXHJcbiAgICAgICAgICAgICAgICBjb25zdCBjeCA9IHgwICsgdGhpcy5fZ2FwIC8gMjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgICAgICAgW3gwLCB5MF0sIFtjeCwgeTBdLFxyXG4gICAgICAgICAgICAgICAgICAgIFtjeCwgeTJdLCBbeDIsIHkyXSwgICAgIC8vIHVzZSB4MiBhbmQgeTJcclxuICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyB4MSBpcyB2YWxpZFxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3ggPSAoeDAgKyB4MSkgLyAyO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgICAgICBbeDAsIHkwXSwgW2N4LCB5MF0sXHJcbiAgICAgICAgICAgICAgICAgICAgW2N4LCB5MV0sIFt4MSwgeTFdLCAgICAgLy8gdXNlIHgxIGFuZCB5MVxyXG4gICAgICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHggPSBlZGdlLmRhdGEudHVybmluZ1g7XHJcbiAgICAgICAgaWYgKHR4ID49IHgxICYmIHR4ICsgdGhpcy5fZ2FwIC8gMiA+PSB4Mykge1xyXG4gICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAgW3gwLCB5MF0sIFt0eCwgeTBdLFxyXG4gICAgICAgICAgICAgICAgW3R4LCB5Ml0sIFt4MywgeTJdLCAgICAgLy8gdXNlIHgzIGFuZCB5MlxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHggPj0geDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgIFt4MCwgeTBdLCBbdHgsIHkwXSxcclxuICAgICAgICAgICAgICAgIFt0eCwgeTJdLCBbdHggKyB0aGlzLl9nYXAgLyAyLCB5Ml0sICAgICAvLyB1c2UgeDInIGFuZCB5MlxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgICBbeDAsIHkwXSwgW3R4LCB5MF0sXHJcbiAgICAgICAgICAgICAgICBbdHgsIHkxXSwgW3gxLCB5MV0sICAgICAvLyB1c2UgeDEgYW5kIHkxXHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHN5XHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZHlcclxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9XHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBfZ2V0T2Zmc2V0RHN0WShzeSwgZHkpIHtcclxuICAgICAgICByZXR1cm4gKHN5IDwgZHkgPyAtMSA6IDEpICogdGhpcy5fbGluZUhlaWdodCAvIDI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcmV0dXJucyB7KG51bGx8T2JqZWN0KVtdfVxyXG4gICAgICovXHJcbiAgICBnZXRFZGdlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZ3JhcGguZWRnZXMubWFwKGVkZ2UgPT4gdGhpcy5nZXRFZGdlKGVkZ2Uuc3JjLmlkLCBlZGdlLmRzdC5pZCkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGdhcFxyXG4gICAgICogQHJldHVybnMge3RoaXN9XHJcbiAgICAgKi9cclxuICAgIHNldEdhcChnYXApIHtcclxuICAgICAgICB0aGlzLl9nYXAgPSBnYXA7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAgICovXHJcbiAgICBnZXRHYXAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dhcDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsaW5lSGVpZ2h0XHJcbiAgICAgKiBAcmV0dXJucyB7dGhpc31cclxuICAgICAqL1xyXG4gICAgc2V0TGluZUhlaWdodChsaW5lSGVpZ2h0KSB7XHJcbiAgICAgICAgdGhpcy5fbGluZUhlaWdodCA9IGxpbmVIZWlnaHQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAgICovXHJcbiAgICBnZXRMaW5lSGVpZ2h0KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9saW5lSGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGxpbmVTcGFjZVxyXG4gICAgICogQHJldHVybnMge3RoaXN9XHJcbiAgICAgKi9cclxuICAgIHNldExpbmVTcGFjZShsaW5lU3BhY2UpIHtcclxuICAgICAgICB0aGlzLl9saW5lU3BhY2UgPSBsaW5lU3BhY2U7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gICAgICovXHJcbiAgICBnZXRMaW5lU3BhY2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVTcGFjZTtcclxuICAgIH1cclxuXHJcbiAgICBsYXlvdXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2dyYXBoLm5vZGVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGZpbmQgcm9vdFxyXG4gICAgICAgIGxldCByb290ID0gdGhpcy5fZ3JhcGgubm9kZXNbMF07XHJcbiAgICAgICAgd2hpbGUgKHJvb3Qub3V0RWRnZXMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgIHJvb3QgPSByb290Lm91dEVkZ2VzWzBdLmRzdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHJ1biBsYXlvdXQgYWxnb1xyXG4gICAgICAgIGxldCB0cmVlTGF5b3V0QWxnbyA9IG5ldyBUREFHTGF5b3V0QWxnbyhyb290LmlkLCB0aGlzLl9ncmFwaCwgdGhpcy5fZ2FwKTtcclxuICAgICAgICB0cmVlTGF5b3V0QWxnby5zb2x2ZSgpO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7VGRhZ30gZnJvbSBcIkAvYWxnby9UZGFnXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlKCkge1xyXG4gICAgcmV0dXJuIG5ldyBUZGFnKCk7XHJcbn1cclxuIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsIkVkZ2UiLCJpZCIsImRhdGEiLCJzcmMiLCJkc3QiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJnZXRFZGdlSWQiLCJzdGF0aWMiLCJyZW1vdmVJdGVtRnJvbSIsImFycmF5IiwiaXRlbSIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsIkFycmF5VXRpbHMiLCJjb21wYXJhdG9yIiwibWF4SXRlbSIsImZvckVhY2giLCJOb2RlIiwib3V0RWRnZXMiLCJpbkVkZ2VzIiwiR3JhcGgiLCJub2RlcyIsIm5vZGVNYXAiLCJNYXAiLCJlZGdlcyIsImVkZ2VNYXAiLCJhZGROb2RlIiwibm9kZSIsInB1c2giLCJzZXQiLCJyZW1vdmVOb2RlIiwiaGFzIiwiZGVsZXRlIiwiY29uY2F0IiwiZSIsInJlbW92ZUVkZ2UiLCJyZW1vdmVOb2RlQnlJZCIsImFkZEVkZ2UiLCJzcmNJZCIsImRzdElkIiwidW5kZWZpbmVkIiwiZWRnZSIsInJlbW92ZUVkZ2VCeUlkIiwiZWRnZUlkIiwiY29weSIsImciLCJuIiwiVmVydGV4TGF5b3V0IiwieDAiLCJ4MSIsInkiLCJyZW5kZXIiLCJFZGdlTGF5b3V0IiwiaXNIaWRkZW4iLCJ0dXJuaW5nWCIsIk1hcFV0aWxzIiwibWFwIiwiY29tcHV0ZSIsIlREQUdMYXlvdXRBbGdvIiwicm9vdElkIiwiZ3JhcGgiLCJnYXAiLCJ2aXNpdGVkU2V0Iiwic29sdmUiLCJjb21wdXRlSGlkZGVuRWRnZVNldCIsInJlb3JkZXJJbkFuZE91dEVkZ2VzIiwic2V0TGluZXMiLCJtdWx0aU91dE5vZGVzIiwiZmlsdGVyIiwibGVuZ3RoIiwiY3VyTm9kZSIsImRzdE5vZGVzIiwiY2xvc2VzdERzdE5vZGUiLCJldmVyeSIsImRzdE5vZGUiLCJzdWJUcmVlU3RhcnRNYXAiLCJTZXQiLCJwcm9jZXNzU3ViVHJlZVN0YXJ0IiwiSW5maW5pdHkiLCJhZGQiLCJzdGFydCIsImNoaWxkU3RhcnQiLCJNYXRoIiwibWluIiwic29ydCIsImUxIiwiZTIiLCJsaW5lTWFwIiwibGF5b3V0VmVydGV4Iiwibm9kZUlkIiwia2V5cyIsImxpbmUiLCJsb2NhbExpbmVNYXAiLCJsb2NhbEJsb2Nrc01hcCIsImNoaWxkcmVuIiwiYmxvY2tzTWFwIiwibGFzdFZhbGlkQ2hpbGQiLCJsYXN0VmFsaWRSZXN1bHRPYmplY3QiLCJjaGlsZFN0YXJ0TGluZSIsImNoaWxkSWR4IiwiY2hpbGQiLCJzdWJMaW5lTWFwIiwic3ViQmxvY2tzTWFwIiwic2l6ZSIsInN1Yk1pbkxpbmUiLCJ2YWx1ZXMiLCJzdWJNYXhMaW5lIiwibWF4IiwiY29tcHJlc3NlZFN0YXJ0TGluZSIsImxhc3RDaGlsZExpbmUiLCJjdXJDaGlsZExpbmVJblN1YiIsInZhbGlkU3RhcnRMaW5lIiwidGVzdFN0YXJ0TGluZSIsImluY3JlYXNlTGluZU9mZnNldCIsInN1YjJMb2NhbCIsImxpbmVJblN1YiIsImxvY2FsMlN1YiIsImxpbmVJbkxvY2FsIiwidGVzdExpbmUiLCJibG9ja3MwIiwiYmxvY2tzMSIsImIwIiwiYjEiLCJpc092ZXJsYXBwZWRDb25zaWRlclR1cm5pbmdYIiwicHJlY3Vyc29ySWQiLCJlbnRyaWVzIiwic3ViQmxvY2tzIiwibWF4TGluZSIsIm1pblNjb3JlIiwiYmVzdExpbmUiLCJiZXN0R3JvdXBzIiwidGVzdE5vZGUiLCJpc092ZXJsYXBwZWQiLCJncm91cHMiLCJjb21wdXRlQ2hpbGRyZW5Hcm91cHMiLCJjb3N0IiwiZ3JvdXAiLCJpIiwibWF4RW5kIiwiY29tcHV0ZUVkZ2VDb3N0IiwiY2hpbGRDZW50ZXJZIiwicmVkdWNlIiwic3VtIiwiYWJzIiwiQ0hJTERfQ0VOVEVSX1lfRElTVF9QRU5BTFRZIiwiY29uc29sZSIsImVycm9yIiwidGVtcE1hcCIsImNsZWFyIiwiYmxvY2tzIiwibGFzdE5vZGVzSW5FYWNoTGluZSIsIm5vZGVzT25UaGVMZWZ0IiwiYiIsImxhc3ROb2RlIiwicCIsInEiLCJlbmRQb2ludCIsImVuZFBvaW50cyIsInByZWN1cnNvciIsImZpbmQiLCJub2RlV2l0aE1heEVuZCIsIm5vZGUwIiwibm9kZTEiLCJzdGFydDAiLCJlbmQwIiwic3RhcnQxIiwiZW5kMSIsIm9wdGlvbmFsTGluZSIsIm92ZXJsYXBwZWRDaGlsZHJlbiIsIm92ZXJsYXBwZWRDaGlsZHJlbkFib3ZlIiwibGFzdE92ZXJsYXBwZWRBYm92ZSIsImZpcnN0T3ZlcmxhcHBlZEJlbG93Iiwic2VnSW5kZXgwIiwic2VnSW5kZXgxIiwiXyIsInNyY1giLCJzcmNZIiwiZHN0WCIsImRzdFkiLCJYX0ZBQ1RPUiIsIllfRkFDVE9SIiwiWV9VUF9QRU5BTFRZIiwiVGRhZyIsIl9ncmFwaCIsIl9nYXAiLCJfbGluZUhlaWdodCIsIl9saW5lU3BhY2UiLCJzZXROb2RlIiwic2V0RWRnZSIsImdldE5vZGUiLCJ4IiwiX2dldFlUb3AiLCJ3aWR0aCIsImhlaWdodCIsImdldE5vZGVzIiwiZ2V0RWRnZSIsInNyY05vZGUiLCJwb2ludHMiLCJfZ2V0RWRnZVBvaW50cyIsIl9nZXRZQ2VudGVyIiwieDIiLCJ4MyIsInkwIiwieTEiLCJ5MiIsIl9nZXRPZmZzZXREc3RZIiwiY3giLCJ0eCIsInN5IiwiZHkiLCJnZXRFZGdlcyIsInNldEdhcCIsImdldEdhcCIsInNldExpbmVIZWlnaHQiLCJsaW5lSGVpZ2h0IiwiZ2V0TGluZUhlaWdodCIsInNldExpbmVTcGFjZSIsImxpbmVTcGFjZSIsImdldExpbmVTcGFjZSIsImxheW91dCIsImNyZWF0ZSJdLCJzb3VyY2VSb290IjoiIn0=